<?php

$_helper = Mage::helper('mventory_tm/tm');

$_categories = $this->getCategories();
$_selectedCategories = $this->getSelectedCategories();

$_cols = $this->getColsNumber() - 1;

$_tmUrl = $this->getTmUrl();

?>

<div class="grid">
  <table id="tm_selected_categories" class="data" cellspacing="0">
    <colgroup>
      <col width='1' />

      <?php for ($n = 0; $n <= $_cols; ++$n): ?>
      <col />
      <?php endfor; ?>

      <col width='1' />
    </colgroup>

    <tbody>
      <?php foreach ($_selectedCategories as $id): ?>
        <?php if (isset($_categories[$id])): ?>
        <tr class="pointer">
          <td class="checkbox a-center">
            <input type="checkbox" class="category-check" value="<?php echo $id; ?>" checked="checked" />
          </td>

          <?php for ($n = 0; $n <= $_cols; ++$n): ?>
          <td>
            <?php echo isset($_categories[$id]['name'][$n]) ? $_categories[$id]['name'][$n] : ''; ?>
          </td>
          <?php endfor; ?>

          <td class="last">
            <a href="<?php echo $_tmUrl . $_categories[$id]['path']; ?>">
              <?php echo $this->__('View'); ?>
            </a>
          </td>
        </tr>

          <?php $attrs = $_helper->getAttributes($id); ?>

          <?php if ($attrs): ?>
          <tr class="category-attrs">
            <td><?php echo $this->__('Attributes'); ?>:</td>
            <td colspan=<?php echo $_cols + 2; ?> class="last">
            <?php foreach ($attrs as $attr): ?>
              <?php echo $attr['Name'] . ' (' . $attr['Type'] . '), '; ?>
            <?php endforeach; ?> 
            </td>
          </tr>
          <?php endif; ?>
        <?php endif; ?>
      <?php endforeach; ?>
    </tbody>
  </table>
</div>

<?php echo $this->getCategoriesButton(); ?>

<div id="tm_categories_wrapper" class="grid"></div>

<script type="text/javascript">
//<![CDATA[

tm_categories_for_category(<?php echo $this->getUrlTemplates() ?>);

//]]>
</script>
